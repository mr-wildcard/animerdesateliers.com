import cheerio from "cheerio";
import del from "del";
import eslexer from "es-module-lexer";
import fs from "fs";
import {bold, green, red, underline, yellow} from "kleur/colors";
import mime from "mime";
import path from "path";
import {performance} from "perf_hooks";
import glob from "tiny-glob";
import hash from "shorthash";
import srcsetParse from "srcset-parse";
import {fileURLToPath} from "url";
import {bundleCSS} from "./build/bundle/css.js";
import {bundleJS, bundleHoistedJS, collectJSImports} from "./build/bundle/js.js";
import {buildStaticPage, getStaticPathsForPage} from "./build/page.js";
import {generateSitemap} from "./build/sitemap.js";
import {collectBundleStats, logURLStats, mapBundleStatsToURLStats} from "./build/stats.js";
import {getDistPath, stopTimer} from "./build/util.js";
import {debug, defaultLogDestination, defaultLogLevel, error, info, warn} from "./logger.js";
import {createRuntime} from "./runtime.js";
const matchSrcset = srcsetParse.default;
const defaultLogging = {
  level: defaultLogLevel,
  dest: defaultLogDestination
};
function isRemoteOrEmbedded(url) {
  return url.startsWith("http://") || url.startsWith("https://") || url.startsWith("//") || url.startsWith("data:");
}
async function build(astroConfig, logging = defaultLogging) {
  const {projectRoot} = astroConfig;
  const buildState = {};
  const depTree = {};
  const timer = {};
  const runtimeLogging = {
    level: "error",
    dest: defaultLogDestination
  };
  if (!astroConfig.buildOptions.site) {
    warn(logging, "config", `Set "buildOptions.site" to generate correct canonical URLs and sitemap`);
  }
  const mode = "production";
  const astroRuntime = await createRuntime(astroConfig, {mode, logging: runtimeLogging});
  const {runtimeConfig} = astroRuntime;
  const {snowpackRuntime} = runtimeConfig;
  try {
    await del(fileURLToPath(astroConfig.dist));
    timer.build = performance.now();
    info(logging, "build", yellow("! building pages..."));
    const allRoutesAndPaths = await Promise.all(runtimeConfig.manifest.routes.map(async (route) => {
      if (route.path) {
        return [route, [route.path]];
      } else {
        const result = await getStaticPathsForPage({
          astroConfig,
          astroRuntime,
          route,
          snowpackRuntime,
          logging
        });
        if (result.rss.xml) {
          if (buildState[result.rss.url]) {
            throw new Error(`[getStaticPaths] RSS feed ${result.rss.url} already exists.
Use \`rss(data, {url: '...'})\` to choose a unique, custom URL. (${route.component})`);
          }
          buildState[result.rss.url] = {
            srcPath: new URL(result.rss.url, projectRoot),
            contents: result.rss.xml,
            contentType: "text/xml",
            encoding: "utf8"
          };
        }
        return [route, result.paths];
      }
    }));
    try {
      await Promise.all(allRoutesAndPaths.map(async ([route, paths]) => {
        for (const p of paths) {
          await buildStaticPage({
            astroConfig,
            buildState,
            route,
            path: p,
            astroRuntime
          });
        }
      }));
    } catch (e) {
      if (e.filename) {
        let stack = e.stack.replace(/Object\.__render \(/gm, "").replace(/\/_astro\/(.+)\.astro\.js\:\d+\:\d+\)/gm, (_, $1) => "file://" + fileURLToPath(projectRoot) + $1 + ".astro").split("\n");
        stack.splice(1, 0, `    at file://${e.filename}`);
        stack = stack.join("\n");
        error(logging, "build", `${red(`Unable to render ${underline(e.filename.replace(fileURLToPath(projectRoot), ""))}`)}

${stack}
`);
      } else {
        error(logging, "build", e.message);
      }
      error(logging, "build", red("\u2715 building pages failed!"));
      await astroRuntime.shutdown();
      return 1;
    }
    info(logging, "build", green("\u2714"), "pages built.");
    debug(logging, "build", `built pages [${stopTimer(timer.build)}]`);
    timer.deps = performance.now();
    const scanPromises = [];
    await eslexer.init;
    for (const id of Object.keys(buildState)) {
      if (buildState[id].contentType !== "text/html")
        continue;
      const pageDeps = findDeps(buildState[id].contents, {
        astroConfig,
        srcPath: buildState[id].srcPath,
        id
      });
      depTree[id] = pageDeps;
      for (const url of [...pageDeps.js, ...pageDeps.css, ...pageDeps.images]) {
        if (!buildState[url])
          scanPromises.push(astroRuntime.load(url).then((result) => {
            if (result.statusCode === 404) {
              if (url.startsWith("/_astro/")) {
                throw new Error(`${buildState[id].srcPath.href}: could not find file "${url}".`);
              }
              warn(logging, "build", `${buildState[id].srcPath.href}: could not find file "${url}". Marked as external.`);
              return;
            }
            if (result.statusCode !== 200) {
              throw result.error || new Error(`unexpected ${result.statusCode} response from "${url}".`);
            }
            buildState[url] = {
              srcPath: new URL(url, projectRoot),
              contents: result.contents,
              contentType: result.contentType || mime.getType(url) || ""
            };
          }));
      }
    }
    await Promise.all(scanPromises);
    debug(logging, "build", `scanned deps [${stopTimer(timer.deps)}]`);
    info(logging, "build", yellow("! optimizing css..."));
    timer.prebundleCSS = performance.now();
    await Promise.all([
      bundleCSS({buildState, astroConfig, logging, depTree}).then(() => {
        debug(logging, "build", `bundled CSS [${stopTimer(timer.prebundleCSS)}]`);
      }),
      bundleHoistedJS({buildState, astroConfig, logging, depTree, runtime: astroRuntime, dist: astroConfig.dist})
    ]);
    info(logging, "build", green("\u2714"), "css optimized.");
    const urlStats = await collectBundleStats(buildState, depTree);
    const jsImports = await collectJSImports(buildState);
    if (astroConfig.buildOptions.sitemap && astroConfig.buildOptions.site) {
      timer.sitemap = performance.now();
      info(logging, "build", yellow("! creating sitemap..."));
      const sitemap = generateSitemap(buildState, astroConfig.buildOptions.site);
      const sitemapPath = new URL("sitemap.xml", astroConfig.dist);
      await fs.promises.mkdir(path.dirname(fileURLToPath(sitemapPath)), {recursive: true});
      await fs.promises.writeFile(sitemapPath, sitemap, "utf8");
      info(logging, "build", green("\u2714"), "sitemap built.");
      debug(logging, "build", `built sitemap [${stopTimer(timer.sitemap)}]`);
    }
    timer.write = performance.now();
    for (const id of Object.keys(buildState)) {
      const outPath = new URL(`.${id}`, astroConfig.dist);
      const parentDir = path.dirname(fileURLToPath(outPath));
      await fs.promises.mkdir(parentDir, {recursive: true});
      const handle = await fs.promises.open(outPath, "w");
      await fs.promises.writeFile(handle, buildState[id].contents, buildState[id].encoding);
      await handle.close();
      delete buildState[id];
      delete depTree[id];
    }
    debug(logging, "build", `wrote files to disk [${stopTimer(timer.write)}]`);
    if (fs.existsSync(astroConfig.public)) {
      info(logging, "build", yellow(`! copying public folder...`));
      timer.public = performance.now();
      const cwd = fileURLToPath(astroConfig.public);
      const publicFiles = await glob("**/*", {cwd, filesOnly: true});
      await Promise.all(publicFiles.map(async (filepath) => {
        const srcPath = new URL(filepath, astroConfig.public);
        const distPath = new URL(filepath, astroConfig.dist);
        await fs.promises.mkdir(path.dirname(fileURLToPath(distPath)), {recursive: true});
        await fs.promises.copyFile(srcPath, distPath);
      }));
      debug(logging, "build", `copied public folder [${stopTimer(timer.public)}]`);
      info(logging, "build", green("\u2714"), "public folder copied.");
    } else {
      if (path.basename(astroConfig.public.toString()) !== "public") {
        info(logging, "tip", yellow(`! no public folder ${astroConfig.public} found...`));
      }
    }
    info(logging, "build", yellow(`! bundling...`));
    if (jsImports.size > 0) {
      timer.bundleJS = performance.now();
      const jsStats = await bundleJS(jsImports, {dist: astroConfig.dist, astroRuntime});
      mapBundleStatsToURLStats({urlStats, depTree, bundleStats: jsStats});
      debug(logging, "build", `bundled JS [${stopTimer(timer.bundleJS)}]`);
      info(logging, "build", green(`\u2714`), "bundling complete.");
    }
    logURLStats(logging, urlStats);
    await astroRuntime.shutdown();
    info(logging, "build", bold(green("\u25B6 Build Complete!")));
    return 0;
  } catch (err) {
    error(logging, "build", err.message);
    await astroRuntime.shutdown();
    return 1;
  }
}
function findDeps(html, {astroConfig, srcPath}) {
  const pageDeps = {
    js: new Set(),
    css: new Set(),
    images: new Set(),
    hoistedJS: new Map()
  };
  const $ = cheerio.load(html);
  $("script").each((_i, el) => {
    const src = $(el).attr("src");
    const hoist = $(el).attr("data-astro") === "hoist";
    if (hoist) {
      if (src) {
        pageDeps.hoistedJS.set(src, {
          src
        });
      } else {
        let content = $(el).html() || "";
        pageDeps.hoistedJS.set(`astro-virtual:${hash.unique(content)}`, {
          content
        });
      }
    } else if (src) {
      if (isRemoteOrEmbedded(src))
        return;
      pageDeps.js.add(getDistPath(src, {astroConfig, srcPath}));
    } else {
      const text = $(el).html();
      if (!text)
        return;
      const [imports] = eslexer.parse(text);
      for (const spec of imports) {
        const importSrc = spec.n;
        if (importSrc && !isRemoteOrEmbedded(importSrc)) {
          pageDeps.js.add(getDistPath(importSrc, {astroConfig, srcPath}));
        }
      }
    }
  });
  $("link[href]").each((_i, el) => {
    const href = $(el).attr("href");
    if (href && !isRemoteOrEmbedded(href) && ($(el).attr("rel") === "stylesheet" || $(el).attr("type") === "text/css" || href.endsWith(".css"))) {
      const dist = getDistPath(href, {astroConfig, srcPath});
      pageDeps.css.add(dist);
    }
  });
  $("img[src]").each((_i, el) => {
    const src = $(el).attr("src");
    if (src && !isRemoteOrEmbedded(src)) {
      pageDeps.images.add(getDistPath(src, {astroConfig, srcPath}));
    }
  });
  $("img[srcset]").each((_i, el) => {
    const srcset = $(el).attr("srcset") || "";
    for (const src of matchSrcset(srcset)) {
      if (!isRemoteOrEmbedded(src.url)) {
        pageDeps.images.add(getDistPath(src.url, {astroConfig, srcPath}));
      }
    }
  });
  $("source[srcset]").each((_i, el) => {
    const srcset = $(el).attr("srcset") || "";
    for (const src of matchSrcset(srcset)) {
      if (!isRemoteOrEmbedded(src.url)) {
        pageDeps.images.add(getDistPath(src.url, {astroConfig, srcPath}));
      }
    }
  });
  return pageDeps;
}
export {
  build,
  findDeps
};
//# sourceMappingURL=data:application/json;base64,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
